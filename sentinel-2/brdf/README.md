---
title: BRDF Normalisation Script - Sentinel 2
parent: Sentinel-2
grand_parent: Sentinel
layout: script
permalink: /sentinel-2/brdf/
nav_exclude: true
examples:
- zoom: '10'
  lat: '-25.56846'
  lng: '138.1723'
  datasetId: S2L2A
  fromTime: '2022-01-01T00:00:00.000Z'
  toTime: '2022-01-04T23:59:59.999Z'
  platform:
  - CDSE
  - EOB
  evalscript: Ly9WRVJTSU9OPTMKCi8vIFRSVUUgQ09MT1IKdmFyIGJhbmRzID0gWyJCMDQiLCAiQjAzIiwgIkIwMiJdCnZhciBsdW0gPSAyLjUKdmFyIHNhbXBsZV90eXBlID0gIkFVVE8iCgovLyBGQUxTRSBDT0xPUgovLyB2YXIgYmFuZHMgPSBbIkIwOCIsICJCMDQiLCAiQjAzIl0KLy8gdmFyIGx1bSA9IDIuNQovLyB2YXIgc2FtcGxlX3R5cGUgPSAiQVVUTyIKCi8vIFJBVyBWQUxVRVMKLy8gdmFyIGJhbmRzID0gWyJCMDIiLCAiQjAzIiwgIkIwNCIsICJCMDgiLCAiQjExIiwgIkIxMiJdCi8vIHZhciBsdW0gPSAxCi8vIHZhciBzYW1wbGVfdHlwZSA9ICJGTE9BVDMyIgoKCmZ1bmN0aW9uIHNldHVwKCkgewogICAgcmV0dXJuIHsKICAgICAgICBpbnB1dDogYmFuZHMuY29uY2F0KFsic3VuQXppbXV0aEFuZ2xlcyIsICJzdW5aZW5pdGhBbmdsZXMiLCAidmlld0F6aW11dGhNZWFuIiwgInZpZXdaZW5pdGhNZWFuIl0pLAogICAgICAgIG91dHB1dDogewogICAgICAgICAgICBiYW5kczogYmFuZHMubGVuZ3RoLAogICAgICAgICAgICBzYW1wbGVUeXBlOiBzYW1wbGVfdHlwZQogICAgICAgIH0sCiAgICAgICAgbW9zYWlja2luZzogIlRJTEUiCiAgICB9Owp9CgpmdW5jdGlvbiBldmFsdWF0ZVBpeGVsKHNhbXBsZSkgewogICAgZm9yIChsZXQgaSA9IDA7IGkgPCBzYW1wbGUubGVuZ3RoOyBpKyspIHsKICAgICAgICAvLyBPbmx5IGNhbGN1bGF0ZSB0aGUgQlJERiBmb3IgcGl4ZWxzIHdoZXJlIHRoZSAKICAgICAgICAvLyB2aWV3IGdlb21ldHJ5IGlzIGF2YWlsYWJsZSAob24gdGhlIGVkZ2VzIG9mIHRpbGVzCiAgICAgICAgLy8gcmVmbGVjdGFuY2UgaXMgYXZhaWxhYmxlIGJ1dCBub3QgdmlldyBnZW9tZXRyeSkKICAgICAgICBpZiAoc2FtcGxlW2ldLnZpZXdBemltdXRoTWVhbiA+IDEpIHsKICAgICAgICAgICAgdmFyIGF2YWlsYWJsZSA9IHNhbXBsZVtpXQogICAgICAgICAgICB2YXIgc2FhID0gZGVnMnJhZChhdmFpbGFibGUuc3VuQXppbXV0aEFuZ2xlcyk7CiAgICAgICAgICAgIHZhciBzemEgPSBkZWcycmFkKGF2YWlsYWJsZS5zdW5aZW5pdGhBbmdsZXMpOwogICAgICAgICAgICB2YXIgdmFhID0gZGVnMnJhZChhdmFpbGFibGUudmlld0F6aW11dGhNZWFuKTsKICAgICAgICAgICAgdmFyIHZ6YSA9IGRlZzJyYWQoYXZhaWxhYmxlLnZpZXdaZW5pdGhNZWFuKTsKCiAgICAgICAgICAgIGxldCBjb25zdGFudCA9IGJ1aWxkX2NvbnN0YW50cyhzemEsIHZ6YSwgc2FhLCB2YWEpOwogICAgICAgICAgICBsZXQgY192emFfemVybyA9IGJ1aWxkX2NvbnN0YW50cyhzemEsIDAsIHNhYSwgdmFhKTsKICAgICAgICAgICAgbGV0IGtlcm5lbHMgPSB7CiAgICAgICAgICAgICAgICBrZ2VvOiBjYWxjX2tnZW8oY29uc3RhbnQpLAogICAgICAgICAgICAgICAga3ZvbDogY2FsY19rdm9sKGNvbnN0YW50KSwKICAgICAgICAgICAgICAgIGtnZW9fdnphX3plcm86IGNhbGNfa2dlbyhjX3Z6YV96ZXJvKSwKICAgICAgICAgICAgICAgIGt2b2xfdnphX3plcm86IGNhbGNfa3ZvbChjX3Z6YV96ZXJvKQogICAgICAgICAgICB9CgogICAgICAgICAgICByZXR1cm4gYmFuZHMubWFwKGJhbmQgPT4gbHVtICogY2FsY19uYmFyKAogICAgICAgICAgICAgICAgYXZhaWxhYmxlW2JhbmRdLAogICAgICAgICAgICAgICAgZl92YWx1ZXNbYmFuZF0sCiAgICAgICAgICAgICAgICBrZXJuZWxzKSk7CiAgICAgICAgfQogICAgfQogICAgcmV0dXJuIFswLCAwLCAwXQp9CgovLyBLZXJuZWwgUGFyYW1ldGVycyAoUm95IGV0IGFsLiAyMDE3LCBUYWJsZSAxKQovLyBbZl9pc28sIGZfZ2VvLCBmX3ZvbF0KdmFyIGZfdmFsdWVzID0gewogICAgIkIwMiI6IFswLjA3NzQsIDAuMDA3OSwgMC4wMzcyXSwKICAgICJCMDMiOiBbMC4xMzA2LCAwLjAxNzgsIDAuMDU4MF0sCiAgICAiQjA0IjogWzAuMTY5MCwgMC4wMjI3LCAwLjA1NzRdLAogICAgIkIwOCI6IFswLjMwOTMsIDAuMDMzMCwgMC4xNTM1XSwKICAgICJCMTEiOiBbMC4zNDMwLCAwLjA0NTMsIDAuMTE1NF0sCiAgICAiQjEyIjogWzAuMjY1OCwgMC4wMzg3LCAwLjA2MzldCn07CgpmdW5jdGlvbiBidWlsZF9jb25zdGFudHMoc3phLCB2emEsIHNhYSwgdmFhKSB7CiAgICAvLyBjYWxjdWxhdGVzIGNvbnN0YW50cyBmcm9tIHZpZXdpbmcgZ2VvbWV0cnkgdGhhdCBhcmUgb2Z0ZW4gbmVlZGVkIGluIHRoZQogICAgLy8gY2FsY3VsYXRpb25zIGFuZCBhcmUgZXhwZW5zaXZlIHRvIGNhbGN1bGF0ZSAoaS5lLiB0YW4pCiAgICBjb25zdCBwaGkgPSByZWxhdGl2ZV9hemltdXRoKHNhYSwgdmFhKTsKICAgIGxldCBjID0gewogICAgICAgIGNvczogewogICAgICAgICAgICBzemE6IE1hdGguY29zKHN6YSksCiAgICAgICAgICAgIHZ6YTogTWF0aC5jb3ModnphKSwKICAgICAgICAgICAgcGhpOiBNYXRoLmNvcyhwaGkpLAogICAgICAgIH0sCiAgICAgICAgc2luOiB7CiAgICAgICAgICAgIHN6YTogTWF0aC5zaW4oc3phKSwKICAgICAgICAgICAgdnphOiBNYXRoLnNpbih2emEpLAogICAgICAgICAgICBwaGk6IE1hdGguc2luKHBoaSksCiAgICAgICAgfSwKICAgICAgICBzZWM6IHsKICAgICAgICAgICAgc3phOiBzZWMoc3phKSwKICAgICAgICAgICAgdnphOiBzZWModnphKSwKICAgICAgICB9LAogICAgICAgIHRhbjoge30KICAgIH07CiAgICBjLnRhbi5zemEgPSBjLnNpbi5zemEgLyBjLmNvcy5zemE7CiAgICBjLnRhbi52emEgPSBjLnNpbi52emEgLyBjLmNvcy52emE7CiAgICAvL2MgNDMgTHVjaHQKICAgIGMuY29zX3hpID0gYy5jb3Muc3phICogYy5jb3MudnphICsgYy5zaW4uc3phICogYy5zaW4udnphICogYy5jb3MucGhpOwogICAgcmV0dXJuIGMKfQoKZnVuY3Rpb24gZGVnMnJhZCh4KSB7CiAgICAvLyBDb252ZXJ0IGRlZ3JlZXMgdG8gcmFkaWFucwogICAgcmV0dXJuIHggKiBNYXRoLlBJIC8gMTgwOwp9CgpmdW5jdGlvbiBzZWMoeCkgewogICAgLy8gQ2FsY3VsYXRlIHRoZSBzZWNhbnQgb2YgYSB2YWx1ZQogICAgcmV0dXJuIDEgLyBNYXRoLmNvcyh4KTsKfQoKZnVuY3Rpb24gcmVsYXRpdmVfYXppbXV0aChzYWEsIHZhYSkgewogICAgLy8gQ2FsY3VsYXRlIHJlbGF0aXZlIGF6aW11dGggYW5nbGUKICAgIC8vIEFuZ2xlcyBpbiBSQUQgIQogICAgbGV0IHBoaSA9IE1hdGguYWJzKHNhYSAtIHZhYSkKICAgIGxldCBkaWZmID0gMAogICAgaWYgKHBoaSA+IE1hdGguUEkpIHsKICAgICAgICBkaWZmID0gMiAqIE1hdGguUEkgLSBwaGk7CiAgICB9IGVsc2UgewogICAgICAgIGRpZmYgPSBwaGk7CiAgICB9CiAgICByZXR1cm4gZGlmZjsKfQoKZnVuY3Rpb24gY2FsY19rZ2VvKGMpIHsKICAgIC8vIENhbGN1bGF0ZSB0aGUgTGlTcGFyc2Uga2VybmVsIGZyb20gTHVjaHQgZXQgYWwuIDIwMDAKICAgIC8vIEFuZ2xlcyBpbiBSQUQgIQoKICAgIC8vIHN6YSA9IHRoZXRhX3ByaW1lID0gTWF0aC5hdGFuKGIgLyByICogTWF0aC50YW4oc3phKSkgc2ltcGxpZmllcyBiZWNhdXNlIGIvciA9IDEKICAgIC8vIHZ6YSA9IGxldHRoZXRhX3ByaW1lID0gTWF0aC5hdGFuKGIgLyByICogTWF0aC50YW4odnphKSkgc2ltcGxpZmllcyBiZWNhdXNlIGIvciA9IDEKCiAgICAvL2MgNDIgTHVjaHQKICAgIGxldCBEc3EgPSBNYXRoLnBvdyhjLnRhbi5zemEsIDIpICsgTWF0aC5wb3coYy50YW4udnphLCAyKSAtIDIgKiBjLnRhbi5zemEgKiBjLnRhbi52emEgKiBjLmNvcy5waGk7CiAgICBsZXQgdGFudGFuc2luID0gYy50YW4uc3phICogYy50YW4udnphICogYy5zaW4ucGhpOwogICAgbGV0IGNvc3R0b3AgPSBNYXRoLnNxcnQoRHNxICsgTWF0aC5wb3codGFudGFuc2luLCAyKSkKCiAgICAvL2MgNDEgTHVjaHQKICAgIGxldCBjb3N0ID0gMiAqIGNvc3R0b3AgLyAoYy5zZWMuc3phICsgYy5zZWMudnphKQogICAgbGV0IHQgPSBNYXRoLmFjb3MoTWF0aC5taW4oMSwgY29zdCkpOwoKICAgIC8vIGMgNDAgTHVjaHQKICAgIGxldCBiaWdfbyA9ICgxIC8gTWF0aC5QSSkgKiAodCAtIE1hdGguc2luKHQpICogTWF0aC5jb3ModCkpICogKGMuc2VjLnN6YSArIGMuc2VjLnZ6YSk7CgogICAgLy8gS2dlbwogICAgbGV0IGtnZW8gPSBiaWdfbyAtIGMuc2VjLnN6YSAtIGMuc2VjLnZ6YSArIDEgLyAyICogKDEgKyBjLmNvc194aSkgKiBjLnNlYy5zemEgKiBjLnNlYy52emE7CgogICAgcmV0dXJuIGtnZW87Cn0KCmZ1bmN0aW9uIGNhbGNfa3ZvbChjKSB7CiAgICAvL0NhbGN1bGF0ZSB0aGUgUm9zc1RoaWNrIGtlcm5lbCAoa192b2wpIGZyb20gTHVjaHQgZXQgYWwuIDIwMDAgZXF1YXRpb24gMzgKICAgIC8vIEFuZ2xlcyBpbiBSQUQgIQoKICAgIC8vIGVxIDQ0CiAgICAvLyBzemEgPSB0aGV0YV9wcmltZSA9IE1hdGguYXRhbihiIC8gciAqIE1hdGgudGFuKHN6YSkpIHNpbXBsaWZpZXMgYmVjYXVzZSBiL3IgPSAxCiAgICAvLyB2emEgPSBsZXR0aGV0YSA9IE1hdGguYXRhbihiIC8gciAqIE1hdGgudGFuKHZ6YSkpIHNpbXBsaWZpZXMgYmVjYXVzZSBiL3IgPSAxCiAgICBsZXQgeGkgPSBNYXRoLmFjb3MoYy5jb3NfeGkpOwoKICAgIGxldCBrdm9sID0gKChNYXRoLlBJIC8gMiAtIHhpKSAqIGMuY29zX3hpICsgTWF0aC5zaW4oeGkpKSAvIChjLmNvcy5zemEgKyBjLmNvcy52emEpIC0gTWF0aC5QSSAvIDQ7CgogICAgcmV0dXJuIGt2b2w7Cn0KCmZ1bmN0aW9uIGNhbGNfcmhvX21vZGlzKGtnZW8sIGt2b2wsIGYpIHsKICAgIC8vIEVxLiA2IGluIFJveSBldCBhbCAyMDE3LCBFcS4gMzcgaW4gTHVjaHQgZXQgYWwgMjAwMAogICAgcmV0dXJuIGZbMF0gKyBmWzFdICoga2dlbyArIGZbMl0gKiBrdm9sOwp9CgpmdW5jdGlvbiBjYWxjX2NfbGFtYmRhKGtlcm5lbHMsIGYpIHsKICAgIC8vIFBhcnQgMiBvZiBFcS4gNSBpbiBSb3kgZXQgYWwgMjAxNwogICAgcmV0dXJuIGNhbGNfcmhvX21vZGlzKGtlcm5lbHMua2dlb192emFfemVybywga2VybmVscy5rdm9sX3Z6YV96ZXJvLCBmKSAvIGNhbGNfcmhvX21vZGlzKGtlcm5lbHMua2dlbywga2VybmVscy5rdm9sLCBmKTsKfQoKZnVuY3Rpb24gY2FsY19uYmFyKHJfczIsIGYsIGtlcm5lbHMpIHsKICAgIC8vUGFydCAxIG9mIEVxLiA1IGluIFJveSBldCBhbCAyMDE3CiAgICAvLyByX3MyOiByZWZsZWN0YW5jZSBpbiBiYW5kIAogICAgLy8gZjogZiB2YWx1ZXMgZm9yIGJhbmQKICAgIGxldCBjX2xhbWJkYSA9IGNhbGNfY19sYW1iZGEoa2VybmVscywgZik7CiAgICByZXR1cm4gY19sYW1iZGEgKiByX3MyOwp9Cg==
  additionalQueryParams:
  - - minQa
    - NaN
---

## General description of the script

Implementation of a Bidirectional Reflectance Distribution Function (BRDF) normalisation for Sentinel-2 scenes in a Sentinel Hub [Evalscript](https://docs.sentinel-hub.com/api/latest/evalscript/v3/).

The Evalscript proposed here is the "semi-empirical BRDF normalisation c-factor correction approach proposed by Luch et al. 2000 [1]. The formula is detailed in eq. 37 (using eq. 38 & 39). To avoid lookup tables and other complex modelling approaches, we use the fixed BRDF spectral model parameters derived from "the global year of highest quality snow-free MODIS BRDF product" conveniently defined for Sentinel-2 in Roy et al. 2017 [2] that were derived from the Landsat ones in Roy et al. 2016 [3].

The approach seems to perform generally quite well for most surfaces (except snow and ice) and high sun angles. Nevertherless, it relies on a certain number of approximations and may not always be suitable.

## Usage

BRDF corrections are available for Sentinel 2 bands 2, 3, 4, 8, 11 and 12. In the beginning of the script there is the option to define the bands which the correction should be applied to. It is also possible to set a luminance value in case RGB images are supposed to be generated. The luminance value is a multiplication factor designed to brighten the image for a better visualisation. By default, a factor of 2.5 is applied which works for most surface types. For darker surfaces, such as forests, a higher value may be required.

There are 3 output options available, a True Color and False Color visualization and the option to return Raw Values. Changing what the script does is just a matter of commenting and uncommenting the output options that are available. The output can also be customized following the same schema of the three available output options. This can for example be done to define custom composites using other bands.


## Description of representative images

**Top image**: True Colour RGB acquired with Sentinel-2 (L2A processing level) over the Australian desert, on the border between Queensland and South Australia. The image is composed of two acquisitions from different orbits from 2nd January 2022 and 4th January 2022.

**Bottom image**: Identical to the top image, with the BRDF normalisation applied.

![Uncorrected](fig/uncorrected.jpg)
![Corrected](fig/corrected.jpg)


## References

[1] W. Lucht, C. B. Schaaf and A. H. Strahler, "An algorithm for the retrieval of albedo from space using semiempirical BRDF models," in IEEE Transactions on Geoscience and Remote Sensing, vol. 38, no. 2, pp. 977-998, March 2000, doi: https://doi.org/10.1109/36.841980.

[2] David P. Roy, Jian Li, Hankui K. Zhang, Lin Yan, Haiyan Huang, Zhongbin Li, Examination of Sentinel-2A multi-spectral instrument (MSI) reflectance anisotropy and the suitability of a general method to normalize MSI reflectance to nadir BRDF adjusted reflectance, Remote Sensing of Environment, Volume 199, 2017, Pages 25-38, ISSN 0034-4257, https://doi.org/10.1016/j.rse.2017.06.019.

[3] D.P. Roy, H.K. Zhang, J. Ju, J.L. Gomez-Dans, P.E. Lewis, C.B. Schaaf, Q. Sun, J. Li, H. Huang, V. Kovalskyy, A general method to normalize Landsat reflectance data to nadir BRDF adjusted reflectance, Remote Sensing of Environment, Volume 176, 2016, Pages 255-271, ISSN 0034-4257, https://doi.org/10.1016/j.rse.2016.01.023.