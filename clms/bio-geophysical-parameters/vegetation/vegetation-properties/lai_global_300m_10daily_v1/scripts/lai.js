//VERSION=3
const factor = 1 / 30; 
const offset = 0; 

function setup() {
  return {
    
    input: ["LAI", "dataMask"],
    output: [
      { id: "default", bands: 4, sampleType: "UINT8" },
      { id: "index", bands: 1, sampleType: "FLOAT32" },
      { id: "eobrowserStats", bands: 2, sampleType: "FLOAT32" },
      { id: "dataMask", bands: 1 },
    ],
  };
}

function evaluatePixel(samples) {
  
  var originalValue = samples.LAI;

  let val = originalValue * factor + offset;

  let dataMask = samples.dataMask;

  const indexVal = dataMask === 1 ? val : NaN;
  const imgVals = visualizer.process(val);

  return {
    default: imgVals.concat(dataMask * 255),
    index: [indexVal],
    eobrowserStats: [val, dataMask],
    dataMask: [dataMask],
  };
}


const ColorBar = [
  [0.0, [140, 92, 8]],
  [0.03333333333333333, [141, 94, 7]],
  [0.06666666666666667, [143, 97, 7]],
  [0.1, [145, 100, 7]],
  [0.13333333333333333, [147, 102, 7]],
  [0.16666666666666666, [149, 105, 7]],
  [0.2, [151, 108, 7]],
  [0.23333333333333334, [153, 111, 7]],
  [0.26666666666666666, [155, 113, 6]],
  [0.3, [157, 116, 6]],
  [0.3333333333333333, [159, 119, 6]],
  [0.36666666666666664, [161, 121, 6]],
  [0.4, [163, 124, 6]],
  [0.43333333333333335, [164, 127, 6]],
  [0.4666666666666667, [166, 130, 6]],
  [0.5, [168, 132, 6]],
  [0.5333333333333333, [170, 135, 5]],
  [0.5666666666666667, [172, 138, 5]],
  [0.6, [174, 140, 5]],
  [0.6333333333333333, [176, 143, 5]],
  [0.6666666666666666, [178, 146, 5]],
  [0.7, [180, 149, 5]],
  [0.7333333333333333, [182, 151, 5]],
  [0.7666666666666666, [184, 154, 4]],
  [0.8, [186, 157, 4]],
  [0.8333333333333334, [187, 159, 4]],
  [0.8666666666666667, [189, 162, 4]],
  [0.9, [191, 165, 4]],
  [0.9333333333333333, [193, 168, 4]],
  [0.9666666666666667, [195, 170, 4]],
  [1.0, [197, 173, 4]],
  [1.0333333333333332, [199, 176, 3]],
  [1.0666666666666667, [201, 178, 3]],
  [1.1, [203, 181, 3]],
  [1.1333333333333333, [205, 184, 3]],
  [1.1666666666666667, [207, 187, 3]],
  [1.2, [209, 189, 3]],
  [1.2333333333333334, [210, 192, 3]],
  [1.2666666666666666, [212, 195, 2]],
  [1.3, [214, 197, 2]],
  [1.3333333333333333, [216, 200, 2]],
  [1.3666666666666667, [218, 203, 2]],
  [1.4, [220, 206, 2]],
  [1.4333333333333333, [222, 208, 2]],
  [1.4666666666666666, [224, 211, 2]],
  [1.5, [226, 214, 2]],
  [1.5333333333333332, [228, 216, 1]],
  [1.5666666666666667, [230, 219, 1]],
  [1.6, [232, 222, 1]],
  [1.6333333333333333, [233, 225, 1]],
  [1.6666666666666667, [235, 227, 1]],
  [1.7, [237, 230, 1]],
  [1.7333333333333334, [239, 233, 1]],
  [1.7666666666666666, [241, 235, 0]],
  [1.8, [243, 238, 0]],
  [1.8333333333333333, [245, 241, 0]],
  [1.8666666666666667, [247, 244, 0]],
  [1.9, [249, 246, 0]],
  [1.9333333333333333, [251, 249, 0]],
  [1.9666666666666666, [253, 252, 0]],
  [2.0, [255, 255, 0]],
  [2.033333333333333, [250, 254, 0]],
  [2.0666666666666664, [246, 253, 0]],
  [2.1, [242, 252, 0]],
  [2.1333333333333333, [238, 251, 0]],
  [2.1666666666666665, [233, 250, 0]],
  [2.2, [229, 249, 0]],
  [2.2333333333333334, [225, 248, 0]],
  [2.2666666666666666, [221, 247, 0]],
  [2.3, [216, 246, 0]],
  [2.3333333333333335, [212, 245, 0]],
  [2.3666666666666667, [208, 244, 0]],
  [2.4, [204, 244, 0]],
  [2.433333333333333, [199, 243, 0]],
  [2.466666666666667, [195, 242, 0]],
  [2.5, [191, 241, 0]],
  [2.533333333333333, [187, 240, 0]],
  [2.5666666666666664, [182, 239, 0]],
  [2.6, [178, 238, 0]],
  [2.6333333333333333, [174, 237, 0]],
  [2.6666666666666665, [170, 236, 0]],
  [2.7, [165, 235, 0]],
  [2.7333333333333334, [161, 234, 0]],
  [2.7666666666666666, [157, 233, 0]],
  [2.8, [153, 233, 0]],
  [2.8333333333333335, [148, 232, 0]],
  [2.8666666666666667, [144, 231, 0]],
  [2.9, [140, 230, 0]],
  [2.933333333333333, [136, 229, 0]],
  [2.966666666666667, [131, 228, 0]],
  [3.0, [127, 227, 0]],
  [3.033333333333333, [123, 226, 0]],
  [3.0666666666666664, [119, 225, 0]],
  [3.1, [114, 224, 0]],
  [3.1333333333333333, [110, 223, 0]],
  [3.1666666666666665, [106, 222, 0]],
  [3.2, [102, 222, 0]],
  [3.2333333333333334, [97, 221, 0]],
  [3.2666666666666666, [93, 220, 0]],
  [3.3, [89, 219, 0]],
  [3.3333333333333335, [85, 218, 0]],
  [3.3666666666666667, [80, 217, 0]],
  [3.4, [76, 216, 0]],
  [3.433333333333333, [72, 215, 0]],
  [3.466666666666667, [68, 214, 0]],
  [3.5, [63, 213, 0]],
  [3.533333333333333, [59, 212, 0]],
  [3.5666666666666664, [55, 211, 0]],
  [3.6, [51, 211, 0]],
  [3.6333333333333333, [46, 210, 0]],
  [3.6666666666666665, [42, 209, 0]],
  [3.6999999999999997, [38, 208, 0]],
  [3.7333333333333334, [34, 207, 0]],
  [3.7666666666666666, [29, 206, 0]],
  [3.8, [25, 205, 0]],
  [3.8333333333333335, [21, 204, 0]],
  [3.8666666666666667, [17, 203, 0]],
  [3.9, [12, 202, 0]],
  [3.933333333333333, [8, 201, 0]],
  [3.966666666666667, [4, 200, 0]],
  [4.0, [0, 200, 0]],
  [4.033333333333333, [0, 198, 0]],
  [4.066666666666666, [0, 197, 0]],
  [4.1, [0, 196, 0]],
  [4.133333333333333, [0, 195, 0]],
  [4.166666666666667, [0, 194, 0]],
  [4.2, [0, 193, 0]],
  [4.233333333333333, [0, 192, 0]],
  [4.266666666666667, [0, 191, 0]],
  [4.3, [0, 190, 0]],
  [4.333333333333333, [0, 188, 0]],
  [4.366666666666666, [0, 187, 0]],
  [4.4, [0, 186, 0]],
  [4.433333333333334, [0, 185, 0]],
  [4.466666666666667, [0, 184, 0]],
  [4.5, [0, 183, 0]],
  [4.533333333333333, [0, 182, 0]],
  [4.566666666666666, [0, 181, 0]],
  [4.6, [0, 180, 0]],
  [4.633333333333333, [0, 178, 0]],
  [4.666666666666667, [0, 177, 0]],
  [4.7, [0, 176, 0]],
  [4.733333333333333, [0, 175, 0]],
  [4.766666666666667, [0, 174, 0]],
  [4.8, [0, 173, 0]],
  [4.833333333333333, [0, 172, 0]],
  [4.866666666666666, [0, 171, 0]],
  [4.9, [0, 170, 0]],
  [4.933333333333334, [0, 168, 0]],
  [4.966666666666667, [0, 167, 0]],
  [5.0, [0, 166, 0]],
  [5.033333333333333, [0, 165, 0]],
  [5.066666666666666, [0, 164, 0]],
  [5.1, [0, 163, 0]],
  [5.133333333333333, [0, 162, 0]],
  [5.166666666666667, [0, 161, 0]],
  [5.2, [0, 160, 0]],
  [5.233333333333333, [0, 158, 0]],
  [5.266666666666667, [0, 157, 0]],
  [5.3, [0, 156, 0]],
  [5.333333333333333, [0, 155, 0]],
  [5.366666666666666, [0, 154, 0]],
  [5.4, [0, 153, 0]],
  [5.433333333333334, [0, 152, 0]],
  [5.466666666666667, [0, 151, 0]],
  [5.5, [0, 150, 0]],
  [5.533333333333333, [0, 148, 0]],
  [5.566666666666666, [0, 147, 0]],
  [5.6, [0, 146, 0]],
  [5.633333333333333, [0, 145, 0]],
  [5.666666666666667, [0, 144, 0]],
  [5.7, [0, 143, 0]],
  [5.733333333333333, [0, 142, 0]],
  [5.766666666666667, [0, 141, 0]],
  [5.8, [0, 140, 0]],
  [5.833333333333333, [0, 138, 0]],
  [5.866666666666666, [0, 137, 0]],
  [5.9, [0, 136, 0]],
  [5.933333333333334, [0, 135, 0]],
  [5.966666666666667, [0, 134, 0]],
  [6.0, [0, 133, 0]],
  [6.033333333333333, [0, 132, 0]],
  [6.066666666666666, [0, 131, 0]],
  [6.1, [0, 130, 0]],
  [6.133333333333333, [0, 128, 0]],
  [6.166666666666667, [0, 127, 0]],
  [6.2, [0, 126, 0]],
  [6.233333333333333, [0, 125, 0]],
  [6.266666666666667, [0, 124, 0]],
  [6.3, [0, 123, 0]],
  [6.333333333333333, [0, 122, 0]],
  [6.366666666666666, [0, 121, 0]],
  [6.4, [0, 120, 0]],
  [6.433333333333334, [0, 118, 0]],
  [6.466666666666667, [0, 117, 0]],
  [6.5, [0, 116, 0]],
  [6.533333333333333, [0, 115, 0]],
  [6.566666666666666, [0, 114, 0]],
  [6.6, [0, 113, 0]],
  [6.633333333333333, [0, 112, 0]],
  [6.666666666666667, [0, 111, 0]],
  [6.7, [0, 110, 0]],
  [6.733333333333333, [0, 108, 0]],
  [6.766666666666667, [0, 107, 0]],
  [6.8, [0, 106, 0]],
  [6.833333333333333, [0, 105, 0]],
  [6.866666666666666, [0, 104, 0]],
  [6.8999999999999995, [0, 103, 0]],
  [6.933333333333334, [0, 102, 0]],
  [6.966666666666667, [0, 101, 0]],
  [7.0, [0, 100, 0]],
  [7.033333333333333, [255, 255, 255]],
  [8.5, [255, 255, 255]],
];
const visualizer = new ColorRampVisualizer(ColorBar);
