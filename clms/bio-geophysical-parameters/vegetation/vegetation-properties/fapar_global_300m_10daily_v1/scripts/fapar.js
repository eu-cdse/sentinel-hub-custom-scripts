//VERSION=3
const factor = 1 / 250; 
const offset = 0; 

function setup() {
  return {
    
    input: ["FAPAR", "dataMask"],
    output: [
      { id: "default", bands: 4, sampleType: "UINT8" },
      { id: "index", bands: 1, sampleType: "FLOAT32" },
      { id: "eobrowserStats", bands: 2, sampleType: "FLOAT32" },
      { id: "dataMask", bands: 1 },
    ],
  };
}

function evaluatePixel(samples) {
  
  var originalValue = samples.FAPAR;

  let val = originalValue * factor + offset;

  let dataMask = samples.dataMask;

  const indexVal = dataMask === 1 ? val : NaN;
  const imgVals = visualizer.process(val);

  return {
    default: imgVals.concat(dataMask * 255),
    index: [indexVal],
    eobrowserStats: [val, dataMask],
    dataMask: [dataMask],
  };
}


const ColorBar = [
  [0.0, [32, 16, 0]],
  [0.0, [32, 16, 0]],
  [0.004, [35, 19, 0]],
  [0.008, [39, 23, 0]],
  [0.012, [42, 27, 0]],
  [0.016, [46, 31, 0]],
  [0.02, [49, 34, 0]],
  [0.024, [53, 38, 0]],
  [0.028, [56, 42, 0]],
  [0.032, [60, 46, 0]],
  [0.036000000000000004, [63, 49, 0]],
  [0.04, [67, 53, 0]],
  [0.044, [70, 57, 0]],
  [0.048, [74, 61, 0]],
  [0.052000000000000005, [77, 64, 0]],
  [0.056, [81, 68, 0]],
  [0.06, [84, 72, 0]],
  [0.064, [88, 76, 0]],
  [0.068, [91, 79, 0]],
  [0.07200000000000001, [95, 83, 0]],
  [0.076, [98, 87, 0]],
  [0.08, [102, 91, 0]],
  [0.084, [105, 94, 0]],
  [0.088, [109, 98, 0]],
  [0.092, [112, 102, 0]],
  [0.096, [116, 106, 0]],
  [0.1, [119, 110, 0]],
  [0.10400000000000001, [123, 113, 0]],
  [0.108, [126, 117, 0]],
  [0.112, [130, 121, 0]],
  [0.116, [133, 125, 0]],
  [0.12, [137, 128, 0]],
  [0.124, [140, 132, 0]],
  [0.128, [144, 136, 0]],
  [0.132, [147, 140, 0]],
  [0.136, [151, 143, 0]],
  [0.14, [154, 147, 0]],
  [0.14400000000000002, [158, 151, 0]],
  [0.148, [161, 155, 0]],
  [0.152, [165, 158, 0]],
  [0.156, [168, 162, 0]],
  [0.16, [172, 166, 0]],
  [0.164, [175, 170, 0]],
  [0.168, [179, 173, 0]],
  [0.17200000000000001, [182, 177, 0]],
  [0.176, [186, 181, 0]],
  [0.18, [189, 185, 0]],
  [0.184, [193, 188, 0]],
  [0.188, [196, 192, 0]],
  [0.192, [200, 196, 0]],
  [0.196, [203, 200, 0]],
  [0.2, [207, 204, 0]],
  [0.20400000000000001, [207, 204, 0]],
  [0.20800000000000002, [208, 205, 0]],
  [0.212, [209, 206, 0]],
  [0.216, [209, 207, 0]],
  [0.22, [210, 207, 0]],
  [0.224, [211, 208, 0]],
  [0.228, [212, 209, 0]],
  [0.232, [212, 210, 0]],
  [0.23600000000000002, [213, 210, 0]],
  [0.24, [214, 211, 0]],
  [0.244, [214, 212, 0]],
  [0.248, [215, 213, 0]],
  [0.252, [216, 213, 0]],
  [0.256, [217, 214, 0]],
  [0.26, [217, 215, 0]],
  [0.264, [218, 216, 0]],
  [0.268, [219, 216, 0]],
  [0.272, [219, 217, 0]],
  [0.276, [220, 218, 0]],
  [0.28, [221, 219, 0]],
  [0.28400000000000003, [222, 219, 0]],
  [0.28800000000000003, [222, 220, 0]],
  [0.292, [223, 221, 0]],
  [0.296, [224, 222, 0]],
  [0.3, [224, 223, 0]],
  [0.304, [225, 223, 0]],
  [0.308, [226, 224, 0]],
  [0.312, [227, 225, 0]],
  [0.316, [227, 226, 0]],
  [0.32, [228, 226, 0]],
  [0.324, [229, 227, 0]],
  [0.328, [229, 228, 0]],
  [0.332, [230, 229, 0]],
  [0.336, [231, 229, 0]],
  [0.34, [232, 230, 0]],
  [0.34400000000000003, [232, 231, 0]],
  [0.34800000000000003, [233, 232, 0]],
  [0.352, [234, 232, 0]],
  [0.356, [234, 233, 0]],
  [0.36, [235, 234, 0]],
  [0.364, [236, 235, 0]],
  [0.368, [237, 235, 0]],
  [0.372, [237, 236, 0]],
  [0.376, [238, 237, 0]],
  [0.38, [239, 238, 0]],
  [0.384, [239, 239, 0]],
  [0.388, [240, 239, 0]],
  [0.392, [241, 240, 0]],
  [0.396, [242, 241, 0]],
  [0.4, [242, 242, 0]],
  [0.404, [243, 242, 0]],
  [0.40800000000000003, [244, 243, 0]],
  [0.41200000000000003, [244, 244, 0]],
  [0.41600000000000004, [245, 245, 0]],
  [0.42, [246, 245, 0]],
  [0.424, [247, 246, 0]],
  [0.428, [247, 247, 0]],
  [0.432, [248, 248, 0]],
  [0.436, [249, 248, 0]],
  [0.44, [249, 249, 0]],
  [0.444, [250, 250, 0]],
  [0.448, [251, 251, 0]],
  [0.452, [252, 251, 0]],
  [0.456, [252, 252, 0]],
  [0.46, [253, 253, 0]],
  [0.464, [254, 254, 0]],
  [0.468, [255, 255, 0]],
  [0.47200000000000003, [254, 253, 0]],
  [0.47600000000000003, [253, 252, 0]],
  [0.48, [252, 251, 0]],
  [0.484, [251, 250, 0]],
  [0.488, [250, 249, 0]],
  [0.492, [250, 248, 0]],
  [0.496, [249, 247, 0]],
  [0.5, [248, 246, 0]],
  [0.504, [247, 245, 0]],
  [0.508, [246, 244, 0]],
  [0.512, [246, 243, 0]],
  [0.516, [245, 242, 0]],
  [0.52, [244, 240, 0]],
  [0.524, [243, 239, 0]],
  [0.528, [242, 238, 0]],
  [0.532, [242, 237, 0]],
  [0.536, [241, 236, 0]],
  [0.54, [240, 235, 0]],
  [0.544, [239, 234, 0]],
  [0.548, [238, 233, 0]],
  [0.552, [238, 232, 0]],
  [0.556, [237, 231, 0]],
  [0.56, [236, 230, 0]],
  [0.5640000000000001, [235, 229, 0]],
  [0.5680000000000001, [234, 228, 0]],
  [0.5720000000000001, [234, 226, 0]],
  [0.5760000000000001, [233, 225, 0]],
  [0.58, [232, 224, 0]],
  [0.584, [231, 223, 0]],
  [0.588, [230, 222, 0]],
  [0.592, [230, 221, 0]],
  [0.596, [229, 220, 0]],
  [0.6, [228, 219, 0]],
  [0.604, [227, 218, 0]],
  [0.608, [226, 217, 0]],
  [0.612, [226, 216, 0]],
  [0.616, [225, 215, 0]],
  [0.62, [224, 214, 0]],
  [0.624, [223, 212, 0]],
  [0.628, [222, 211, 0]],
  [0.632, [222, 210, 0]],
  [0.636, [221, 209, 0]],
  [0.64, [220, 208, 0]],
  [0.644, [219, 207, 0]],
  [0.648, [218, 206, 0]],
  [0.652, [218, 205, 0]],
  [0.656, [217, 204, 0]],
  [0.66, [216, 203, 0]],
  [0.664, [215, 202, 0]],
  [0.668, [214, 201, 0]],
  [0.672, [214, 200, 0]],
  [0.676, [214, 197, 0]],
  [0.68, [215, 194, 0]],
  [0.684, [215, 191, 0]],
  [0.6880000000000001, [216, 188, 0]],
  [0.6920000000000001, [217, 185, 0]],
  [0.6960000000000001, [217, 182, 0]],
  [0.7000000000000001, [218, 179, 0]],
  [0.704, [218, 176, 0]],
  [0.708, [219, 173, 0]],
  [0.712, [220, 170, 0]],
  [0.716, [220, 167, 0]],
  [0.72, [221, 164, 0]],
  [0.724, [221, 161, 0]],
  [0.728, [222, 158, 0]],
  [0.732, [223, 155, 0]],
  [0.736, [223, 152, 0]],
  [0.74, [224, 149, 0]],
  [0.744, [225, 146, 0]],
  [0.748, [225, 143, 0]],
  [0.752, [226, 140, 0]],
  [0.756, [226, 137, 0]],
  [0.76, [227, 134, 0]],
  [0.764, [228, 131, 0]],
  [0.768, [228, 128, 0]],
  [0.772, [229, 125, 0]],
  [0.776, [229, 122, 0]],
  [0.78, [230, 119, 0]],
  [0.784, [231, 116, 0]],
  [0.788, [231, 113, 0]],
  [0.792, [232, 110, 0]],
  [0.796, [232, 107, 0]],
  [0.8, [233, 104, 0]],
  [0.804, [234, 101, 0]],
  [0.808, [234, 98, 0]],
  [0.812, [235, 95, 0]],
  [0.8160000000000001, [236, 92, 0]],
  [0.8200000000000001, [236, 89, 0]],
  [0.8240000000000001, [237, 86, 0]],
  [0.8280000000000001, [237, 83, 0]],
  [0.8320000000000001, [238, 80, 0]],
  [0.836, [239, 77, 0]],
  [0.84, [239, 74, 0]],
  [0.844, [240, 71, 0]],
  [0.848, [240, 68, 0]],
  [0.852, [241, 65, 0]],
  [0.856, [242, 62, 0]],
  [0.86, [242, 59, 0]],
  [0.864, [243, 56, 0]],
  [0.868, [243, 53, 0]],
  [0.872, [244, 50, 0]],
  [0.876, [245, 47, 0]],
  [0.88, [245, 44, 0]],
  [0.884, [246, 41, 0]],
  [0.888, [247, 38, 0]],
  [0.892, [247, 35, 0]],
  [0.896, [248, 32, 0]],
  [0.9, [248, 29, 0]],
  [0.904, [249, 26, 0]],
  [0.908, [250, 23, 0]],
  [0.912, [250, 20, 0]],
  [0.916, [251, 17, 0]],
  [0.92, [251, 14, 0]],
  [0.924, [252, 11, 0]],
  [0.928, [253, 8, 0]],
  [0.932, [253, 5, 0]],
  [0.936, [254, 2, 0]],
  [0.9400000000000001, [255, 0, 0]],
  [0.9440000000000001, [255, 255, 255]],
  [1.02, [255, 255, 255]],
];
const visualizer = new ColorRampVisualizer(ColorBar);
