//VERSION=3
const factor = 1 / 250; 
const offset = 0; 

function setup() {
  return {
    
    input: ["FAPAR", "dataMask"],
    output: [
      { id: "default", bands: 4, sampleType: "UINT8" },
      { id: "index", bands: 1, sampleType: "FLOAT32" },
      { id: "eobrowserStats", bands: 2, sampleType: "FLOAT32" },
      { id: "dataMask", bands: 1 },
    ],
  };
}

function evaluatePixel(samples) {
  
  var originalValue = samples.FAPAR;

  let val = originalValue * factor + offset;

  let dataMask = samples.dataMask;

  const indexVal = dataMask === 1 ? val : NaN;
  const imgVals = visualizer.process(originalValue);

  return {
    default: imgVals.concat(dataMask * 255),
    index: [indexVal],
    eobrowserStats: [val, dataMask],
    dataMask: [dataMask],
  };
}


const ColorBar = [
  [0, [32, 16, 0]],
  [0, [32, 16, 0]],
  [1, [35, 19, 0]],
  [2, [39, 23, 0]],
  [3, [42, 27, 0]],
  [4, [46, 31, 0]],
  [5, [49, 34, 0]],
  [6, [53, 38, 0]],
  [7, [56, 42, 0]],
  [8, [60, 46, 0]],
  [9, [63, 49, 0]],
  [10, [67, 53, 0]],
  [11, [70, 57, 0]],
  [12, [74, 61, 0]],
  [13, [77, 64, 0]],
  [14, [81, 68, 0]],
  [15, [84, 72, 0]],
  [16, [88, 76, 0]],
  [17, [91, 79, 0]],
  [18, [95, 83, 0]],
  [19, [98, 87, 0]],
  [20, [102, 91, 0]],
  [21, [105, 94, 0]],
  [22, [109, 98, 0]],
  [23, [112, 102, 0]],
  [24, [116, 106, 0]],
  [25, [119, 110, 0]],
  [26, [123, 113, 0]],
  [27, [126, 117, 0]],
  [28, [130, 121, 0]],
  [29, [133, 125, 0]],
  [30, [137, 128, 0]],
  [31, [140, 132, 0]],
  [32, [144, 136, 0]],
  [33, [147, 140, 0]],
  [34, [151, 143, 0]],
  [35, [154, 147, 0]],
  [36, [158, 151, 0]],
  [37, [161, 155, 0]],
  [38, [165, 158, 0]],
  [39, [168, 162, 0]],
  [40, [172, 166, 0]],
  [41, [175, 170, 0]],
  [42, [179, 173, 0]],
  [43, [182, 177, 0]],
  [44, [186, 181, 0]],
  [45, [189, 185, 0]],
  [46, [193, 188, 0]],
  [47, [196, 192, 0]],
  [48, [200, 196, 0]],
  [49, [203, 200, 0]],
  [50, [207, 204, 0]],
  [51, [207, 204, 0]],
  [52, [208, 205, 0]],
  [53, [209, 206, 0]],
  [54, [209, 207, 0]],
  [55, [210, 207, 0]],
  [56, [211, 208, 0]],
  [57, [212, 209, 0]],
  [58, [212, 210, 0]],
  [59, [213, 210, 0]],
  [60, [214, 211, 0]],
  [61, [214, 212, 0]],
  [62, [215, 213, 0]],
  [63, [216, 213, 0]],
  [64, [217, 214, 0]],
  [65, [217, 215, 0]],
  [66, [218, 216, 0]],
  [67, [219, 216, 0]],
  [68, [219, 217, 0]],
  [69, [220, 218, 0]],
  [70, [221, 219, 0]],
  [71, [222, 219, 0]],
  [72, [222, 220, 0]],
  [73, [223, 221, 0]],
  [74, [224, 222, 0]],
  [75, [224, 223, 0]],
  [76, [225, 223, 0]],
  [77, [226, 224, 0]],
  [78, [227, 225, 0]],
  [79, [227, 226, 0]],
  [80, [228, 226, 0]],
  [81, [229, 227, 0]],
  [82, [229, 228, 0]],
  [83, [230, 229, 0]],
  [84, [231, 229, 0]],
  [85, [232, 230, 0]],
  [86, [232, 231, 0]],
  [87, [233, 232, 0]],
  [88, [234, 232, 0]],
  [89, [234, 233, 0]],
  [90, [235, 234, 0]],
  [91, [236, 235, 0]],
  [92, [237, 235, 0]],
  [93, [237, 236, 0]],
  [94, [238, 237, 0]],
  [95, [239, 238, 0]],
  [96, [239, 239, 0]],
  [97, [240, 239, 0]],
  [98, [241, 240, 0]],
  [99, [242, 241, 0]],
  [100, [242, 242, 0]],
  [101, [243, 242, 0]],
  [102, [244, 243, 0]],
  [103, [244, 244, 0]],
  [104, [245, 245, 0]],
  [105, [246, 245, 0]],
  [106, [247, 246, 0]],
  [107, [247, 247, 0]],
  [108, [248, 248, 0]],
  [109, [249, 248, 0]],
  [110, [249, 249, 0]],
  [111, [250, 250, 0]],
  [112, [251, 251, 0]],
  [113, [252, 251, 0]],
  [114, [252, 252, 0]],
  [115, [253, 253, 0]],
  [116, [254, 254, 0]],
  [117, [255, 255, 0]],
  [118, [254, 253, 0]],
  [119, [253, 252, 0]],
  [120, [252, 251, 0]],
  [121, [251, 250, 0]],
  [122, [250, 249, 0]],
  [123, [250, 248, 0]],
  [124, [249, 247, 0]],
  [125, [248, 246, 0]],
  [126, [247, 245, 0]],
  [127, [246, 244, 0]],
  [128, [246, 243, 0]],
  [129, [245, 242, 0]],
  [130, [244, 240, 0]],
  [131, [243, 239, 0]],
  [132, [242, 238, 0]],
  [133, [242, 237, 0]],
  [134, [241, 236, 0]],
  [135, [240, 235, 0]],
  [136, [239, 234, 0]],
  [137, [238, 233, 0]],
  [138, [238, 232, 0]],
  [139, [237, 231, 0]],
  [140, [236, 230, 0]],
  [141, [235, 229, 0]],
  [142, [234, 228, 0]],
  [143, [234, 226, 0]],
  [144, [233, 225, 0]],
  [145, [232, 224, 0]],
  [146, [231, 223, 0]],
  [147, [230, 222, 0]],
  [148, [230, 221, 0]],
  [149, [229, 220, 0]],
  [150, [228, 219, 0]],
  [151, [227, 218, 0]],
  [152, [226, 217, 0]],
  [153, [226, 216, 0]],
  [154, [225, 215, 0]],
  [155, [224, 214, 0]],
  [156, [223, 212, 0]],
  [157, [222, 211, 0]],
  [158, [222, 210, 0]],
  [159, [221, 209, 0]],
  [160, [220, 208, 0]],
  [161, [219, 207, 0]],
  [162, [218, 206, 0]],
  [163, [218, 205, 0]],
  [164, [217, 204, 0]],
  [165, [216, 203, 0]],
  [166, [215, 202, 0]],
  [167, [214, 201, 0]],
  [168, [214, 200, 0]],
  [169, [214, 197, 0]],
  [170, [215, 194, 0]],
  [171, [215, 191, 0]],
  [172, [216, 188, 0]],
  [173, [217, 185, 0]],
  [174, [217, 182, 0]],
  [175, [218, 179, 0]],
  [176, [218, 176, 0]],
  [177, [219, 173, 0]],
  [178, [220, 170, 0]],
  [179, [220, 167, 0]],
  [180, [221, 164, 0]],
  [181, [221, 161, 0]],
  [182, [222, 158, 0]],
  [183, [223, 155, 0]],
  [184, [223, 152, 0]],
  [185, [224, 149, 0]],
  [186, [225, 146, 0]],
  [187, [225, 143, 0]],
  [188, [226, 140, 0]],
  [189, [226, 137, 0]],
  [190, [227, 134, 0]],
  [191, [228, 131, 0]],
  [192, [228, 128, 0]],
  [193, [229, 125, 0]],
  [194, [229, 122, 0]],
  [195, [230, 119, 0]],
  [196, [231, 116, 0]],
  [197, [231, 113, 0]],
  [198, [232, 110, 0]],
  [199, [232, 107, 0]],
  [200, [233, 104, 0]],
  [201, [234, 101, 0]],
  [202, [234, 98, 0]],
  [203, [235, 95, 0]],
  [204, [236, 92, 0]],
  [205, [236, 89, 0]],
  [206, [237, 86, 0]],
  [207, [237, 83, 0]],
  [208, [238, 80, 0]],
  [209, [239, 77, 0]],
  [210, [239, 74, 0]],
  [211, [240, 71, 0]],
  [212, [240, 68, 0]],
  [213, [241, 65, 0]],
  [214, [242, 62, 0]],
  [215, [242, 59, 0]],
  [216, [243, 56, 0]],
  [217, [243, 53, 0]],
  [218, [244, 50, 0]],
  [219, [245, 47, 0]],
  [220, [245, 44, 0]],
  [221, [246, 41, 0]],
  [222, [247, 38, 0]],
  [223, [247, 35, 0]],
  [224, [248, 32, 0]],
  [225, [248, 29, 0]],
  [226, [249, 26, 0]],
  [227, [250, 23, 0]],
  [228, [250, 20, 0]],
  [229, [251, 17, 0]],
  [230, [251, 14, 0]],
  [231, [252, 11, 0]],
  [232, [253, 8, 0]],
  [233, [253, 5, 0]],
  [234, [254, 2, 0]],
  [235, [255, 0, 0]],
  [236, [255, 255, 255]],
  [255, [255, 255, 255]],
];
const visualizer = new ColorRampVisualizer(ColorBar);
